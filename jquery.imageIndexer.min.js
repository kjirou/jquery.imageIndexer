!function(){var a=[].slice;!function(b){var c;if(null==b.imageIndexer)return b.imageIndexer=function(a){return c.getInstance(a)},b.imageIndexer.getClass=function(){return c},b.imageIndexer.version="0.1.2",c=function(){function c(){this._images={},this.withPreloading=!0}return c._instances={},c.getInstance=function(a){return null==a&&(a="default"),a in this._instances?this._instances[a]:this._instances[a]=new c},c.cleanInstances=function(){return this._instances={}},c.prototype.clip=function(a,c,d,e,f,g){var h,i;if(null==g&&(g={}),h=b.extend({withPreloading:null},g),this._hasImageData(a))throw new Error("The imageKey="+a+" already exists.");if(!this._withinSize(d,e,f))throw new Error("Pos=["+e+"] size=["+f+"] is not within ["+d+"].");return(null!=(i=h.withPreloading)?i:this.withPreloading)&&this._preload(c),this._images[a]={type:"clip",url:c,fullSize:d.slice(),clipPos:e.slice(),clipSize:f.slice()}},c.prototype.upload=function(a,b,c){return this.clip(a,b,c,[0,0],c.slice())},c.prototype.partition=function(a,c,d,e,f){var g,h,i,j;if(null==f&&(f={}),g=b.extend({targetPos:[0,0],targetSize:d.slice(),withPreloading:null},f),this._hasImageData(a))throw new Error("The imageKey="+a+" already exists.");if(h=g.targetPos.slice(),i=g.targetSize.slice(),!this._withinSize(d,h,i))throw new Error("Pos=["+h+"] size=["+i+"] is not within ["+d+"].");if(!this._isEqualDevidable(i,e))throw new Error("Size=["+i+"] can't be divide equally by ["+e+"].");return(null!=(j=g.withPreloading)?j:this.withPreloading)&&this._preload(c),this._images[a]={type:"partition",url:c,fullSize:d,partSize:e,targetPos:h,targetSize:i}},c.prototype._getImageData=function(a){var b,c;return null!=(b=null!=(c=this._images)?c[a]:void 0)?b:null},c.prototype._hasImageData=function(a){return null!==this._getImageData(a)},c.prototype._getImageDataOrError=function(a){var b;return function(){if(null!=(b=this._getImageData(a)))return b;throw new Error("Not found image key="+a+".")}.call(this)},c.prototype._preload=function(a){return(new Image).src=a},c.prototype._withinSize=function(a,b,c){return a[0]>=b[1]+c[0]&&a[1]>=b[0]+c[1]},c.prototype._isEqualDevidable=function(a,b){return 0===a[0]%b[0]&&0===a[1]%b[1]},c.prototype._argsToPartIndex=function(a,b){var c;if(2===a.length)return[a[0],a[1]];if(1===a.length){if(a[0]instanceof Array)return[a[0][0],a[0][1]];if("number"==typeof a[0]&&a[0]>=1)return c=a[0]-1,[parseInt(c/b,10),c%b]}throw new Error("["+a+"] is invalid part-index.")},c.prototype._partDataToPos=function(a,b,c){return null==c&&(c=[0,0]),[b[1]*a[0]+c[0],b[0]*a[1]+c[1]]},c.prototype.asChip=function(){var c,d,e,f,g;return d=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],c=this._getImageDataOrError(d),"clip"===c.type?b("<div>").css({width:c.clipSize[0],height:c.clipSize[1],overflow:"hidden"}).append(b("<img>").css({display:"block",marginTop:-c.clipPos[0],marginLeft:-c.clipPos[1],width:c.fullSize[0],height:c.fullSize[1]}).attr({src:c.url})):"partition"===c.type?(f=this._argsToPartIndex(e,c.targetSize[0]/c.partSize[0]),g=this._partDataToPos(f,c.partSize,c.targetPos),b("<div>").css({width:c.partSize[0],height:c.partSize[1],overflow:"hidden"}).append(b("<img>").css({display:"block",marginTop:-g[0],marginLeft:-g[1],width:c.fullSize[0],height:c.fullSize[1]}).attr({src:c.url}))):void 0},c.prototype.asData=function(a){return this._getImageData(a)},c}()}(jQuery)}.call(this);